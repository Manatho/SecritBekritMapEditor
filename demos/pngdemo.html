<!DOCTYPE html>
<html>

<body style="background-color: rgb(82, 64, 42)">
    <script src="../gui/libs/pako_inflate.min.js"></script>
    <script src="../gui/libs/pako_deflate.min.js"></script>
    <script src="../gui/libs/pako.min.js"></script>

    <img id="original" style="image-rendering: pixelated" src="bigger.png" width="250px" height="250px">
    <img id="copy" style="image-rendering: pixelated" width="250px" height="250px">
    <img id="scratch" style="image-rendering: pixelated" width="250px" height="250px">

    <script src="../gui/scripts/PNG160.js"></script>
    <script>
        function toDataURL(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('get', url);
            xhr.responseType = 'blob';
            xhr.onload = function () {
                var fr = new FileReader();
                fr.readAsArrayBuffer(xhr.response); // async call
                fr.onload = function () {
                    callback(new Uint8Array(this.result))
                };
            };
            xhr.send();
        }

        /*let testimg = document.getElementById("test");
        toDataURL("bigger.png", function (data) {
            data = PNG160.editPNG(data);

            if (data) {
                let blob = new Blob([data.buffer]);
                let testReader = new FileReader();
                testReader.onload = (e) => {
                    testimg.src = e.target.result;
                }
                testReader.readAsDataURL(blob);
            }
        });*/

        let testimg = document.getElementById("copy");
        let copyValues = [];
        toDataURL("bigger.png", function (data) {
            let values = "";
            PNG160.readPixelsOfPNG(data, (width, i, value) => {
                values += (value / 65536).toFixed(3) + " ";
                copyValues.push(value);
                if ((i + 1) % (width) == 0 && i != 0) {
                    values += "\n"
                }
            });


            let finishedPNG = PNG160.createPNG(10, 10, (i) => {
                console.log(copyValues[i], i);
                if(copyValues[i] > 65536/2){
                    return copyValues[i] - 10000;
                } else {
                    return copyValues[i] + 10000;
                }

                
            });

            let scratch = document.getElementById("scratch")
            let blob = new Blob([finishedPNG]);
            let reader = new FileReader();
            reader.onload = (e) => {
                scratch.src = e.target.result;
            }
            reader.readAsDataURL(blob);

        }
        );








    </script>
</body>

</html>